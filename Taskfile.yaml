# https://taskfile.dev

version: '3'

vars:
  BINARY_DIR: bin
  LOG_DIR: log

tasks:
  build:
    cmds:
      - task: build_client
      - task: build_server
  build_client:
    dir: client
    cmds:
      - go build
      - mv client ../{{.BINARY_DIR}}
    silent: true
  build_server:
    dir: server
    cmds:
      - go build
      - mv server ../{{.BINARY_DIR}}
    silent: true
  clean:
    cmds:
      - rm -rf {{.BINARY_DIR}}/*
      - rm -rf {{.LOG_DIR}}/*
  docker:
    build:
      cmds:
        - task: docker_backend
        - task: docker_frontend
        - task: docker_game
  docker_backend:
    cmds:
      - docker build -f docker/Dockerfile.backend -t snake-backend:latest .
  docker_frontend:
    cmds:
      - docker build -f docker/Dockerfile.frontend -t snake-frontend:latest .
  docker_game:
    cmds:
      - docker build -f docker/Dockerfile.gameserver -t snake-gameserver:latest .
  k8s_server:
    cmds:
      - kubectl apply -f ./server.yaml
  k8s_game:
    cmds:
      - kubectl apply -f ./gameserver.yaml